import { Canvas, Meta, Story } from "@storybook/addon-docs";

<Meta title="Auth Plugin Docs/How It Works" />


# How it works

##

<br/>

* ## Working
  
  <br/>
  
  * Auth plugin instance will be running with a **Dapr Sidecar** which
  is managed by our **Engine** plugin.
  
  
  <br/>
  
  
  
  * Behind the scenes our auth plugin instance is written in **Express App** 
  which is connected with our **glue graphql plugin** which is running behind
  the scene.
  
  
  <br/>
  
  * Our **Engine** plugin will treat **auth plugin instance** as
  a seperatre independent microservice. Behind the scene it will handle everything.
  Like providing us baseurl to interact with our authentication application.
  
  <br/>

  * If the auth plugin is installed correctly, then we will get a folder named auth
  inside our functions folder, where our whole logic of authentication is written.

  <br/>
  
  * Our directory stucture for the **Authentication instance auth** will be something
    like this:
    <br/>

    ```
      ðŸ“¦auth
      â”£ ðŸ“‚src
      â”ƒ â”£ ðŸ“‚controllers
      â”ƒ â”ƒ â”£ ðŸ“‚authentication
      â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚graphql
      â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œmutations.ts
      â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œqueries.ts
      â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚handlers
      â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œindex.ts
      â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œsignin.ts
      â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œsignup.ts
      â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œsocialSignin.ts
      â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œuser.ts
      â”ƒ â”ƒ â”ƒ â”— ðŸ“œhelpers.ts
      â”ƒ â”ƒ â”— ðŸ“œcommons.ts
      â”ƒ â”£ ðŸ“‚providers
      â”ƒ â”ƒ â”£ ðŸ“œRoutes.ts
      â”ƒ â”ƒ â”£ ðŸ“œexpress.ts
      â”ƒ â”ƒ â”£ ðŸ“œlocals.ts
      â”ƒ â”ƒ â”— ðŸ“œpassport.ts
      â”ƒ â”£ ðŸ“‚routes
      â”ƒ â”ƒ â”£ ðŸ“œ.gitkeep
      â”ƒ â”ƒ â”— ðŸ“œauthentication.ts
      â”ƒ â”— ðŸ“œindex.ts
      â”£ ðŸ“‚views
      â”ƒ â”— ðŸ“œtoken.html
      â”£ ðŸ“œ.env
      â”£ ðŸ“œDockerfile
      â”£ ðŸ“œREADME.md
      â”£ ðŸ“œpackage.json
      â”£ ðŸ“œrouter.js
      â”£ ðŸ“œtsconfig.json
      â”— ðŸ“œtslint.json
    ```
  <br/>
  <br/>
  
  * In order to interact with this plugin there is a file named routes.js
    present in root directory of the instance. If we open that **routes.js** 
    file, we will see a string value attached to a key named **path**, this
    is the string which we need to append after our nginx url(http://localhost:9090).
  
    In our case our path value will be something like this:
    
      ```
      module.exports = () => [
        {
          "path": "/backend/auth",
          "proxy": {
          "instance": "auth:3500",
          "path": "/v1.0/invoke/auth/method/"
          }
        }
      ];
      ```
    
    <br/>
    
    So in order to access our **auth plugin instance** its base url will be
    something like this,
      
      
    **http://localhost:9090/backend/auth**
  
  <br/>
  <br/>
  
  * In order to start this plugin we need to run the following command:
    
    <br/>
    
    ```bash
      $ node glue develop:up
    ```
    
    <br/>

    This command will start running the docker image of all the instances
    and plugin we have created. Here, in this case it will start running
    our **auth plugin instance image**, inside our **engine** container.
  
  <br/>
  
  * In order to check if this plugin is working correctly, we have already
    created few endpoints which we can check inside server.js file.
  
  <br/>
  
  * For example in order to check health-status of our instance we can send
    **GET Request** to this endpoint:
    
    **http://localhost:9090/backend/func1/health-check**
    
    If we get a response like this:
    
    
    
    This means that our function plugin instance is running perfectly.
    
  <br/>
  <br/>

* ## Instructions to start development of auth plugin instance
  
  <br/>
  
  * Inside our **auth instance directory** we will see that there is
  directory named **src** in which we have **express** app wirtten in 
  **typescript**. We can go ahead and start our development from there.













